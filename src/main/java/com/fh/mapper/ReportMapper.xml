<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper    
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"    
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fh.dao.ReportDao">
	
	<select id="selectForPage" resultType="report">
	select r.id, r.`name`,r.mail,r.phone,r.center,r.subscribe_people,r.arrive_people,r.order_people,
r.new_order,r.old_order ,r.one_day_money,r.hope_money,
r.difference,r.marks from tb_reportforms as r 
     
			<where>
				is_valid = 1 
				
			 <if test="@Ognl@isNotEmpty(name)">
					and name like '%${name}%'
				</if>
				<if test="@Ognl@isNotEmpty(center)">
					and center like '%${center}%'
				</if> 
			</where>
	</select>
	
	<!-- <insert id="insert" useGeneratedKeys="true" keyProperty="id">
		insert into t_customer (
				khno,
				`name`,
				area,
				cus_manager,
				LEVEL,
				myd,
				xyd,
				address,
				post_code,
				phone,
				fax,
				web_site,
				yyzzzch,
				fr,
				zczj,
				nyye,
				khyh,
				khzh,
				dsdjh,
				gsdjh,
				state,
				is_valid,
				create_date,
				update_date
			) VALUES (
				#{khno},
				#{name},
				#{area},
				#{cusManager},
				#{level},
				#{myd},
				#{xyd},
				#{address},
				#{postCode},
				#{phone},
				#{fax},
				#{webSite},
				#{yyzzzch},
				#{fr},
				#{zczj},
				#{nyye},
				#{khyh},
				#{khzh},
				#{dsdjh},
				#{gsdjh},
				#{state},
				#{isValid},
				#{createDate},
				#{updateDate}
			)
	</insert>
	
	<update id="update">
		UPDATE t_customer SET
			`name`=#{name},
			area=#{area},
			cus_manager=#{cusManager},
			LEVEL=#{level},
			myd=#{myd},
			xyd=#{xyd},
			address=#{address},
			post_code=#{postCode},
			phone=#{phone},
			fax=#{fax},
			web_site=#{webSite},
			yyzzzch=#{yyzzzch},
			fr=#{fr},
			zczj=#{zczj},
			nyye=#{nyye},
			khyh=#{khyh},
			khzh=#{khzh},
			dsdjh=#{dsdjh},
			gsdjh=#{gsdjh},
			update_date = #{updateDate}
		WHERE id = #{id}
	</update>
	
	<select id="findLossCustomer" resultType="customer">
		SELECT
			t.id, t.khno, t.cus_manager, t.`name`
		FROM
			t_customer t
		WHERE
			DATE_ADD(update_date, INTERVAL 6 MONTH) &lt;= NOW()
			AND state = 0
			AND id NOT IN (
				SELECT
					cus_id
				FROM
					t_customer_order
			)
	</select>
	
	<select id="findLossCustomerNoOrderLongTime" resultType="customer">
		SELECT
			t.id, t.khno, t.cus_manager, t.`name`
		FROM
			t_customer t
		WHERE
			id IN (
				SELECT
					cus_id
				FROM
					t_customer_order
				WHERE
					DATE_ADD(update_date, INTERVAL 6 MONTH) &lt;= NOW()
				)
		and state = 0
	</select>
	
	<select id="khgxReport" resultType="com.shsxt.vo.CustomerGx">
		SELECT
			t1.id as customerId,
			t1.`name` as customerName,
			sum(t3.sum) as totalAmount
		FROM
			t_customer t1
		LEFT JOIN t_customer_order t2 ON t1.id = t2.cus_id
		LEFT JOIN t_order_details t3 ON t2.id = t3.order_id
		<where>
			<if test="@Ognl@isNotEmpty(customerName)">
				`name` LIKE '%${customerName}%' 
			</if>
		</where>
		GROUP BY t1.id, t1.`name`
	</select>
	
	<select id="khgcReport" resultType="com.shsxt.vo.CustomerGc">
		SELECT `level`, count(id) as amount FROM t_customer GROUP BY `level`
	</select>
	 -->
</mapper>